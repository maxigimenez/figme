<dom-module is="figme-app">

    <template>

        <style>
            .search-box {
                max-width: 500px;
                margin: 30px auto;
            }

            input {
                display: block;
                border: 0;
                outline: 0;
                border-radius: 2px;
                box-shadow: 0px 2px 1px rgba(0,0,0,.1);
                width: 100%;
                color: #000;
                padding: 20px;
                font-size: 20px;
            }

            input::-webkit-search-cancel-button {
                position: relative;
                -webkit-appearance: none;
                cursor: pointer;
            }

            input::-webkit-search-cancel-button:before {
                position: absolute;
                top: -13px;
                right: 0px;
                content: "âœ–";
                color: #bbb;
            }

            ::-webkit-input-placeholder {
                color: #bbb;
            }

            ::-moz-placeholder {
                color: #bbb;
            }

            p {
                margin: 12px 0;
                color: #FFF;
                font-family: 'Roboto', 'Noto', sans-serif;
                font-size: 14px;
                width: 100%;
                height: 15px;
            }

            p span.links {
                float: left;
                margin-top: 3px;
            }

            p span.links a {
                color: #FFF;
                text-decoration: none;
            }

            .giphy {
                background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAaCAMAAADFcOOIAAAArlBMVEX/////////////////Zmb/////////Zmb/////////Zmb///////////////////////////////8AzP8A/5n/Zmb/////////Zmb///8A2uP///9Kgv8AzP+ZM///Zmb//5n///83lf//242x/5n/0In///8A4tNBi/9t/5n///9wJqFoIq50J59bHZj///9gIJcAzP8A/5lMGH9fH5+ZM///Zmb/2Yz//5n///88Cs80AAAAMXRSTlMACBAYICAoMDA4QEBIUFhgaHB4gICAgJCgoLCwusDAwMDAyMzQ0NDg4ODg4eTn7/D3vV0NOgAAAqVJREFUeNrtlety0zAQRj/LKHW6VmQZumkI0JqLS0NpoUDA7/9ieKU4SuvcZphpCfT8iK6e2SOtNnhiJ+crvDs7O8Kh8muFn/P5MQ6Vy8v35x0f5vPTk0NVub19gY7jecvJvyJyenyEiJ02wpT8oGoBUC2Ycracjj2M5ddhOTF+DBHhDB1Z3XRMFMDSAdBEpt00Ad0G8isagL6Rnnl0kayNI5r0RYSqL4JpWFh0pnhwkWcnLZ+/fMKCcB83lfjU/RsJ2L6IWlyE8Z+rBxWJXH+7RsD6OAgA1eJxR2RCROHA+yLBYKZn2xIrty0DQBfMoxSjHIDVQGaVX8phw47Ut5lvKH5KSkaJNZtErr5fIeDjzOBRuCfCaJFIq55I9+lsa2JZS1RwqrnIhq5UhhMM2ADW+SXKwJZyZqXZtEMtzYgtIFuISh7knMJwuknkzY83CNyEOGwVyPoidRSpZYsPHd0r355Y/jyZCoe2LU3KGQyXMiVLAhMwZNKs0eKboY/bWoA4S1yhmbBDJMbLTYDuiyjXRJEIBFkSDLaJpDwMkYws3Ail5UHGCtZJaolI6niguWiHafDx221pC7bixgX+UCTi1oqganZULImWyySIGCtHzKkzowJLEcFijYijvCwTSGLtKzLZJVKr9SLavxIFbHsjwwSFS3xqQbFzyEseYplaRsvq+tQa8Aggxj4idczxaoNIrMqOWiZRBCHtNhOilfMmcqUCitYhZU6wfOwEVRbJymMv2KC7Eaa9RcZdpFB1T2RWtUws0PtD3FMkz+DR1pdfYGAVYHIAXfnNgNTSavkdrpRfSKneS0SHujMZ1+sfu7BL5AHYLQLXrKIPVkSSK2JxwCKgqglMCQcsIihy7Ejhr+fi4uXzO7z9+AqHyNc+r59E/h9+Ax+ByZSH/dyeAAAAAElFTkSuQmCC);
                background-repeat: no-repeat;
                width: 200px;
                height: 26px;
                float: right;
            }
        </style>

        <div class="search-box">

            <input id="search"
                type="search"
                is="iron-input"
                bind-value="{{ query }}"
                placeholder="Search for a gif ..."
                autocomplete="off"
                autofocus />

            <p>
                <span class="links">
                    <a href="https://github.com/maxigimenez/figme" target="_blank"><iron-icon icon="icons:code"></iron-icon></a> with <iron-icon icon="icons:favorite"></iron-icon> by
                    <a href="http://maxigimenez.github.io/" target="_blank">@maxigimenez</a>
                </span>
                <a href="http://giphy.com/" target="_blank" class="giphy"></a>
            </p>

        </div>

        <figme-list
            id="list"
            query="{{ query }}"></figme-list>

    </template>

    <script>
        Polymer({
            is: 'figme-app',
            properties: {
                query: {
                    type: String,
                    value: ''
                }
            },
            ready: function() {
                var search = this.$.search;
                var list = this.$.list;

                search.addEventListener('keypress', function (e) {
                    var code = e.keyCode || e.which;
                    switch(code) {
                        case 13:
                            ga('send', 'event', 'Search', 'Request', this.query);
                            list.removeColorFilter();
                            list.request();
                            break;
                    }
                }.bind(this));

                search.addEventListener('search', function (e) {
                    if ( e.target.value === '' ) {
                        ga('send', 'event', 'Search', 'Clear', '');
                        list.removeColorFilter();
                        list.clear();
                    }
                }.bind(this));

                if ( URIHash.detect('search') ) {
                    this.query = URIHash.getFromIndex(2);
                    list.request();
                    setTimeout(function(){
                        ga('send', 'event', 'Search', 'RequestFromURL', this.query);
                    }.bind(this), 500);
                }
            }
        });
    </script>

</dom-module>
